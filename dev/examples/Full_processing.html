<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Processing data · Spectra documentation</title><meta name="title" content="Processing data · Spectra documentation"/><meta property="og:title" content="Processing data · Spectra documentation"/><meta property="twitter:title" content="Processing data · Spectra documentation"/><meta name="description" content="Documentation for Spectra documentation."/><meta property="og:description" content="Documentation for Spectra documentation."/><meta property="twitter:description" content="Documentation for Spectra documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Spectra documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Welcome to Spectra&#39;s documentation!</a></li><li><span class="tocitem">User manual</span><ul><li><a class="tocitem" href="../PreProcessing.html">Data Processing</a></li><li><a class="tocitem" href="../Measurements.html">Measurements</a></li><li><a class="tocitem" href="../PeakFitting.html">Peak fitting</a></li><li><a class="tocitem" href="../MachineLearning.html">Machine Learning</a></li><li><a class="tocitem" href="../HelperFunctions.html">Helper Functions</a></li><li><a class="tocitem" href="../Tips.html">Tips</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="Baseline_examples.html">Baseline examples</a></li><li class="is-active"><a class="tocitem" href="Full_processing.html">Processing data</a><ul class="internal"><li><a class="tocitem" href="#Signal-creation"><span>Signal creation</span></a></li><li><a class="tocitem" href="#First-possible-steps"><span>First possible steps</span></a></li><li><a class="tocitem" href="#Sort-X-Axis"><span>Sort X Axis</span></a></li><li><a class="tocitem" href="#Remove-spikes"><span>Remove spikes</span></a></li><li><a class="tocitem" href="#Resample-to-have-everything-on-the-same-X-axis"><span>Resample to have everything on the same X axis</span></a></li><li><a class="tocitem" href="#Remove-a-background"><span>Remove a background</span></a></li><li><a class="tocitem" href="#Measure-peak-parameters"><span>Measure peak parameters</span></a></li><li><a class="tocitem" href="#Peak-fitting!"><span>Peak fitting!</span></a></li></ul></li><li><a class="tocitem" href="Raman_spectrum_fitting.html">Peak fitting the Raman spectrum of a glass</a></li><li><a class="tocitem" href="Smoothing.html">Smoothing data</a></li></ul></li><li><a class="tocitem" href="../References.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="Full_processing.html">Processing data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Full_processing.html">Processing data</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/charlesll/Spectra.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/charlesll/Spectra.jl/blob/master/examples/Full_processing.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>The source files for all examples can be found in <a href="https://github.com/charlesll/Spectra.jl/tree/master/examples/">/examples</a>.</p><h1 id="Processing-data"><a class="docs-heading-anchor" href="#Processing-data">Processing data</a><a id="Processing-data-1"></a><a class="docs-heading-anchor-permalink" href="#Processing-data" title="Permalink"></a></h1><p>In this notebook, we reproduce the typical steps here for processing spectra</p><p>For this example, we create two Gaussian signals randomly sampled along two different X axis, with noise and increasing backgrounds. One of them will also have a strong spike!</p><h2 id="Signal-creation"><a class="docs-heading-anchor" href="#Signal-creation">Signal creation</a><a id="Signal-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Signal-creation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Spectra, Plots

# we create a fake signal with
x_1 = rand(1000)*100
x_2 = rand(1000)*100

# create a signal that is the combination of two gaussian peaks plus a background
background_1 = 0.08 * x_1
background_2 = 0.03 * x_2

# some noise
noise_1 = 0.5*randn(1000)
noise_2 = 0.3*randn(1000)

# the full toy signals
y_1 = gaussian(x_1, 10.0, 40., 5.) .+ background_1 .+ noise_1
y_2 = gaussian(x_2, 20.0, 60., 9.) .+ background_2 .+ noise_2

# one of them will have a spike!
y_1[600] = 250.0

# make a plot of our two spectra
scatter(x_1, y_1)
scatter!(x_2, y_2)</code></pre><img src="Full_processing-d7c7e463.svg" alt="Example block output"/><h2 id="First-possible-steps"><a class="docs-heading-anchor" href="#First-possible-steps">First possible steps</a><a id="First-possible-steps-1"></a><a class="docs-heading-anchor-permalink" href="#First-possible-steps" title="Permalink"></a></h2><p>We can do the following steps (not necessarily in this order):</p><ul><li>the X values are randomly sorted, we can solve that using <a href="../PreProcessing.html#Spectra.flipsp"><code>flipsp</code></a></li><li>We may like to get our spectra on the same X axis for convenience using <a href="../PreProcessing.html#Spectra.resample"><code>resample</code></a></li><li>Spikes are present: we can remove them using <a href="../PreProcessing.html#Spectra.despiking"><code>despiking</code></a></li><li>Backgrounds are present: we can remove them using <a href="../PreProcessing.html#Spectra.baseline"><code>baseline</code></a></li><li>Signals are noisy: we can smooth them using <a href="../PreProcessing.html#Spectra.smooth"><code>smooth</code></a></li><li>We can correct for temperature and laser wavelength using <a href="../PreProcessing.html#Spectra.tlcorrection"><code>tlcorrection</code></a></li><li>We can normalize the spectra using <a href="../PreProcessing.html#Spectra.normalise"><code>normalise</code></a></li><li>We can fit the peaks using <a href="../PeakFitting.html#Spectra.fit_peaks"><code>fit_peaks</code></a></li></ul><p>Let&#39;s do it!</p><h2 id="Sort-X-Axis"><a class="docs-heading-anchor" href="#Sort-X-Axis">Sort X Axis</a><a id="Sort-X-Axis-1"></a><a class="docs-heading-anchor-permalink" href="#Sort-X-Axis" title="Permalink"></a></h2><p>We can sort the data by passing an array of spectra. After that we should have not problem plotting things with lines for instance!</p><pre><code class="language-julia hljs">spectrum_1 = flipsp([x_1 y_1])
spectrum_2 = flipsp([x_2 y_2])
plot(spectrum_1[:,1], spectrum_1[:, 2])
plot!(spectrum_2[:,1], spectrum_2[:, 2])</code></pre><p><img src="fp_1.svg" alt/></p><h2 id="Remove-spikes"><a class="docs-heading-anchor" href="#Remove-spikes">Remove spikes</a><a id="Remove-spikes-1"></a><a class="docs-heading-anchor-permalink" href="#Remove-spikes" title="Permalink"></a></h2><p>OK, the plot above reveals a strong spike in one of the signals. We will treat actually both signals with <a href="../PreProcessing.html#Spectra.despiking"><code>despiking</code></a> to remove possible spikes from the signals, using the default parameters. In summary, with the default settings, <a href="../PreProcessing.html#Spectra.despiking"><code>despiking</code></a> checks if any points in a spectrum differ by more than 3 sigma from the mean value of the 4 neighboring points. You can change the default values to adjust the threshold (for more or less than 3-sigma), or to modify the number of neighboring points considered.</p><pre><code class="language-julia hljs">y_1 = despiking(x_1, y_1)
y_2 = despiking(x_2, y_2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1000-element Vector{Float64}:
  0.43202214183221227
  2.2673319051934886
 19.05467129007839
 16.28006546928215
  0.1911514406207961
  3.274329310850362
 18.823299079701155
  0.276197548618184
  3.0923140957943365
  2.761079887494442
  ⋮
  2.1849897543424626
  2.84857798745424
  3.6227572144937397
  0.6301637550253393
 21.433144262209463
 10.42099400031254
  1.4583954800986674
  8.722421645738837
  0.2621855281082648</code></pre><h2 id="Resample-to-have-everything-on-the-same-X-axis"><a class="docs-heading-anchor" href="#Resample-to-have-everything-on-the-same-X-axis">Resample to have everything on the same X axis</a><a id="Resample-to-have-everything-on-the-same-X-axis-1"></a><a class="docs-heading-anchor-permalink" href="#Resample-to-have-everything-on-the-same-X-axis" title="Permalink"></a></h2><p>Using <a href="../PreProcessing.html#Spectra.resample"><code>resample</code></a>, we get everything on the same X axis. As we have two spectra with two different X axis, we simply provide them in a Vector like this:</p><pre><code class="language-julia hljs">x_new = collect(0.:0.5:100)
spectra_ = [[x_1 y_1], [x_2 y_2]]
spectra_same_x = resample(spectra_, x_new)
plot(x_new, spectra_same_x)</code></pre><p><img src="fp_2.svg" alt/></p><p>We see tiny problems with the interpolation, we can solve them using another method from DataInterpolations.jl, such as Linear:</p><pre><code class="language-julia hljs">spectra_same_x = resample(spectra_, x_new, method=&quot;LinearInterpolation&quot;)
plot(x_new, spectra_same_x)</code></pre><p><img src="fp_3.svg" alt/></p><h2 id="Remove-a-background"><a class="docs-heading-anchor" href="#Remove-a-background">Remove a background</a><a id="Remove-a-background-1"></a><a class="docs-heading-anchor-permalink" href="#Remove-a-background" title="Permalink"></a></h2><p>Now we can remove a background using the <a href="../PreProcessing.html#Spectra.baseline"><code>baseline</code></a> function. Similarly to the other functions, you can pass x and y vectors or a x vectors and an array of y spectra. We will do that here:</p><pre><code class="language-julia hljs">ys_corrected, ys_baselines = baseline(x_new, spectra_same_x, method=&quot;arPLS&quot;)
p1 = plot(x_new, spectra_same_x)
plot!(x_new, ys_baselines, labels=[&quot;background 1&quot; &quot;background 2&quot;])</code></pre><p><img src="fp_4.svg" alt/></p><h2 id="Measure-peak-parameters"><a class="docs-heading-anchor" href="#Measure-peak-parameters">Measure peak parameters</a><a id="Measure-peak-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Measure-peak-parameters" title="Permalink"></a></h2><p>We can now measure the parameters of each peak, for instance their centroid:</p><pre><code class="language-julia hljs">println(&quot;Centroids are:&quot;)
println(centroid(x_new, ys_corrected))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Centroids are:
[39.83725025030715, 59.9053187802566]</code></pre><p>The peakmeas function to get access to a bunch of parameters: intensity, position, hwhm, centroïd</p><pre><code class="language-julia hljs">println(&quot;intensity, position, hwhm, centroïd are:&quot;)
println(peakmeas(x_new, ys_corrected[:,1]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">intensity, position, hwhm, centroïd are:
(9.852677699505744, 40.5, 5.0, 39.82623798577805)</code></pre><p>If multiple peaks with a background are present, the best is to use the find<em>peaks() function It can even make a nice plot. Beware that you may have to tweak the window</em>size, min<em>width, min</em>height to detect only the main peaks... See the documentation of <a href="../Measurements.html#Spectra.find_peaks"><code>find_peaks</code></a> for details. for more precise usage, also see the Peaks.jl package.</p><pre><code class="language-julia hljs">result = find_peaks(x_new, ys_corrected[:,1], window_size=1, min_width=2., min_height=2.0, smoothing=true)
println(&quot;Peak positions: &quot;, result.peak_positions)
println(&quot;Peak heights: &quot;, result.peak_heights)
println(&quot;Peak HWHMs: &quot;, result.peak_hwhms)
println(&quot;Peak centroids: &quot;, result.peak_centroids)
result.plot_peaks</code></pre><img src="Full_processing-4f4cd373.svg" alt="Example block output"/><h2 id="Peak-fitting!"><a class="docs-heading-anchor" href="#Peak-fitting!">Peak fitting!</a><a id="Peak-fitting!-1"></a><a class="docs-heading-anchor-permalink" href="#Peak-fitting!" title="Permalink"></a></h2><p>We can retrieve the parameters of the two peaks using peak fitting too! We do a quick fit with very loose prior uncertainties on the peak parameters, and unrestrictive lower<em>bounds and upper</em>bounds. Those informations are provided in a vector of tuples, one tuple per peak: (type, initial<em>params, prior uncertainties, lower</em>bounds, upper_bounds)</p><pre><code class="language-julia hljs">peaks_info = [
        # (type, initial_params, prior uncertainties, lower_bounds, upper_bounds)
        (:gaussian, [10.5, 50.0, 5.0], [100.0, 100.0, 100.0], [0., 0., 0.], [Inf, Inf, Inf]),
    ]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Tuple{Symbol, Vararg{Vector{Float64}, 4}}}:
 (:gaussian, [10.5, 50.0, 5.0], [100.0, 100.0, 100.0], [0.0, 0.0, 0.0], [Inf, Inf, Inf])</code></pre><p>we declare the context and fit the signals</p><pre><code class="language-julia hljs">ctx_1 = prepare_context(x_new, ys_corrected[:,1], peaks_info)
ctx_2 = prepare_context(x_new, ys_corrected[:,2], peaks_info)
result_1 = fit_peaks(ctx_1, backend=:Optim)
result_2 = fit_peaks(ctx_2, backend=:Optim)

println(&quot;Parameters and fit for the first signal:&quot;)
print_params(result_1.peak_results)
plot_fit(ctx_1, result_1.peak_results)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Parameters and fit for the first signal:
Peak 1 (gaussian):
  amplitude: 9.76 ± 0.31
  center: 40.08 ± 0.16
  width: 5.0 ± 0.18
  area: 103.9 ± 3.3</code></pre><p><img src="fp_5.svg" alt/></p><pre><code class="language-julia hljs">println(&quot;Parameters and fit for the second signal:&quot;)
print_params(result_2.peak_results)
plot_fit(ctx_2, result_2.peak_results)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Parameters and fit for the second signal:
Peak 1 (gaussian):
  amplitude: 19.98 ± 0.24
  center: 59.99 ± 0.1
  width: 8.92 ± 0.12
  area: 379.3 ± 4.5</code></pre><p><img src="fp_6.svg" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Baseline_examples.html">« Baseline examples</a><a class="docs-footer-nextpage" href="Raman_spectrum_fitting.html">Peak fitting the Raman spectrum of a glass »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Saturday 3 May 2025 20:30">Saturday 3 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
